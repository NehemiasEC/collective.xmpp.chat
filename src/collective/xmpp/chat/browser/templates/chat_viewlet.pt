<div id="chatpanel"
    tal:define="is_anon context/portal_membership/isAnonymousUser;
                portal_url context/portal_url"
    tal:condition="not: is_anon">

    <div id="collective-xmpp-chat-data" 
        tal:define="
                portal context/@@plone_portal_state/portal;
                member context/@@plone_portal_state/member;
                username member/getId;
                base_url python:context.portal_url();"
        tal:attributes="
                username username;
                base_url base_url;
                "></div>

    <div id="toggle-controlbox">
        <a href="#" class="chat" id="toggle-online-users">
            Online Users (<strong id="online-count">0</strong>)
        </a>
    </div>
</div>
